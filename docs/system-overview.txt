KiddieCheck System Overview (as of 2026-01-26)

Purpose
- A Laravel-based web system for early childhood developmental screening using the ECCD checklist.
- Supports interactive tests conducted by families (parents/guardians) and teachers, with admin oversight.
- Computes per-domain scaled scores and an overall standard score, provides aggregation and discrepancy analysis across observers.

Tech Stack
- Backend: Laravel Framework 12 on PHP 8.2.
- Frontend tooling: Vite 7, TailwindCSS 4, Axios (basic);
  Vite integration via laravel-vite-plugin.
- Dev workflow: Composer scripts and NPM scripts; optional Laravel Sail, Pint, Collision.

Authentication & Roles
- Users authenticate via email/password. Roles: `family`, `teacher`, `admin`.
- Post-login redirects by role to dedicated dashboards.
- Sessions stored in `sessions` table (migration 2026_01_25_130000_create_sessions_table.php).

High-Level Features
- Family Dashboard: view children, see monthly test status, start tests when eligible, review results.
- Teacher Dashboard: view assigned students, check eligibility, run tests, and review results.
- Admin Area: manage users, families, teachers, sections, students; schedule tests; view reports;
  manage domains and questions.

Routing (major)
- Public & Auth:
  - `/` → Welcome page.
  - `/login`, `/register` → forms + actions; `/logout`.
- Admin (`/admin/...`): index, users CRUD, families CRUD + assign students,
  teachers CRUD + assign students, sections CRUD + per-section student create,
  reports, profile, help, domains overview.
- Family (`/family/...`): dashboard, child detail, test lifecycle (start, question-by-question,
  result, finalize, mark-incomplete, cancel, terminate).
- Teacher (`/teacher/...`): dashboard, student detail, test lifecycle similar to family.

Data Model (tables and relationships)
- `users`: app accounts with `role` and `status`.
  - Relationships: one `family` (for role family), one `teacher` (for role teacher).
- `families`: links to a `user`, holds `name`, `home_address` and has many `students`.
- `teachers`: primary key equals `users.id`; info like `hire_date`, `status`. Has many `students` via pivot.
- `sections`: class/grouping for students; has many `students`.
- `students` (aka children): belongs to `family` and optional `section`; attributes include `dob`, `gender`,
  `enrollment_date`, `status`, `profile_path`, `notes`. Has many `tests`, `tags`, and many `teachers` via pivot.
- Pivot `teacher_student`: many-to-many teacher↔student with `role` (homeroom/specialist/others), `assigned_at`, `status`.
- `domains`: ECCD domains (e.g., Cognitive, Motor, Language); has many `questions` and `scores`.
- `questions`: per-domain items; `type` is `static|interactive` with optional instructions/materials/procedure.
- `tests`: a screening instance per student with `observer_id` (link to `users`), `test_date`, computed `age_months`,
  `status`, and submission metadata.
  - Unique constraint on (`student_id`,`test_date`).
  - Relationships: belongs to `student`, `observer` (user); has many `responses`, `scores`, `pictures`.
- `test_responses`: per-question answer within a test; `score` is numeric (1.0 yes, 0.0 no, null for N/A).
- `domain_scores`: per-domain computed summary for a test: `raw_score`, `scaled_score`, `scaled_score_based` (count of applicable items).
- `test_pictures`: optional photo evidence linked to a test (and optionally a question) with `file_path`.
- `student_tags`: child flags/notes (`allergy`, `medical`, `learning_needs`, `others`) with optional text.
- `sessions`: Laravel session storage for auth/session state.

Models
- `User`: fillable core fields; casts hashed password; relations to `Family` and `Teacher`.
- `Family`: belongs to `User`; has many `Student`.
- `Teacher`: belongs to `User` (via id), many-to-many `Student` via `teacher_student` with pivot fields.
- `Section`: has many `Student`.
- `Student`: belongs to `Family` and `Section`; many-to-many `Teacher`; has many `Tag` and `Test`.
- `Domain`: has many `Question` and `DomainScore`.
- `Question`: belongs to `Domain`; has many `TestResponse` and `TestPicture`.
- `Test`: belongs to `Student` and `observer` (`User`); has many `TestResponse`, `DomainScore`, `TestPicture`.
  - Hooks compute `age_months` from `student.dob` and `test_date`.
- `TestResponse`, `DomainScore`, `TestPicture`: standard child relations.

Test Scheduling & Eligibility
- Admin auto-schedules three pending tests on student creation, anchored to `enrollment_date`:
  - Window 1: months 1–6 (start at +1 month)
  - Window 2: months 7–13 (start at +7 months)
  - Window 3: months 14–20 (start at +14 months)
- Family/Teacher may start a test only within the current 6‑month window and if overall constraints allow:
  - Max 3 tests per student that are not cancelled/terminated.
  - Enforce ≥6 months since last non-cancelled test.
  - If a pending test is scheduled for the window start day, that record is reused by setting `observer_id`, marking `in_progress`,
    and initializing question order.
- Deterministic/randomized question order per domain is stored in session (separate keys for family vs teacher flows).

Answering & Scoring
- Each question is answered as `yes|no|na`.
  - `yes` → score 1.0, `no` → 0.0, `na` → null (excluded from applicability).
- Per-domain summary for a test:
  - `raw_score`: count of `yes` among applicable responses.
  - Percentage: `yes_count / applicable_count * 100`.
  - `scaled_score`: mapped via `EccdScoring::percentageToScaled()` to 1–19.
  - `scaled_score_based`: number of applicable items.
- Overall standard score (70–160):
  - Prefer explicit lookup if `standard_score_lookup` contains the rounded sum of scaled scores.
  - Otherwise, linearly map the clamped sum of scaled scores over [domains×min,max] to [70,160].
- Classifications:
  - Scaled: 14–19 Advanced; 7–13 Average; 1–6 Re-test 3–6 months.
  - Standard: 121–160 Advanced Development; 70–120 Average; <70 Re-test after 3–6 months.

Aggregation & Discrepancy Analysis
- Aggregates computed per 6‑month window across tests:
  - Modes: `average` (default), `median`, `latest`.
  - Optional inclusion and weighting of family tests (`family_weight`, default 1.0).
- By role: separate aggregates for `teacher` and `family`, and a `combined` view.
- Discrepancy detection:
  - Flag per-domain when |teacher − family| ≥ `domain_delta_threshold` (default 3 scaled points).
  - Flag overall when |teacher − family| ≥ `standard_delta_threshold` (default 10 points).

Admin Features
- Users: create/update/delete with validation; safeguards prevent deleting users with existing `teacher`/`family` profiles.
- Families: manage details; assign students; prevent deleting families that still have students.
- Teachers: create/update/delete; assign students with roles; detaches pivot on delete.
- Sections: manage classes; create students inside a section; prevents deleting sections with students.
- Students: creation via section includes validation and scheduling; prevents deletion if tests exist.
- Reports: consolidated view of tests with linked students, observers, responses, and scores.
- Domains & Questions: list domains and ordered questions.

Family & Teacher Flows
- Start test: eligibility checks → reuse scheduled pending or insert in-progress test → initialize per-domain question order → navigate to first question.
- Questioning: step through ordered questions per domain; `na` preserved for applicability but not counted in raw score.
- Result: compute domain scores, sum scaled, derive standard score; show aggregates for the window and discrepancy analysis.
- Finalize/cancel/terminate/incomplete: record end-state and redirect to appropriate view.

Seeder (KiddieCheckDemoSeeder)
- Creates a demo `Section`, ensures `Domain` entries exist (Cognitive, Motor, Language).
- Adds three scenarios:
  - A: Student A with family + two teachers; completed tests for all three observers in Window 2.
  - B: Student B with family + one teacher; completed tests for both in Window 1.
  - C: Student C with family + one teacher; completed test by teacher in Window 3.
- For each test:
  - Finds a free `test_date` within the 6‑month window, creates a `completed` test with `submitted_by` observer role.
  - Seeds mid-range per-domain scaled scores (7–13) and placeholder raw scores.

Frontend & Views
- Family and Teacher views for dashboards, question pages, and results.
- Admin views for index, users, families, teachers, sections & students, reports, profile, help, domains.
- Vite + TailwindCSS bundle; dev server via `npm run dev`.

Dev & Ops Scripts
- Composer `setup`: install, copy `.env` if missing, key:generate, migrate, `npm install`, build.
- Composer `dev`: runs `php artisan serve`, queue listener, pail logs, and Vite dev concurrently (Windows-compatible).
- Composer `test`: clears config cache then runs `artisan test`.

Notable Observations & Potential Issues
- Test status enum mismatch: controllers set `incomplete`, but `tests.status` migration defines only
  `pending|in_progress|completed|cancelled|terminated`.
- Children migration down(): drops `children` instead of `students` (typo).
- `StudentTag` model exists; migration/table named `student_tags` (consistent), relation on `Student` is `hasMany(StudentTag)`.
- Some flows rely on session keys (`test_order_*`); if session resets, order rebuilds with a fresh shuffle.

Current Coverage Summary
- Core domain objects, test lifecycle, scoring/aggregation, admin management, and demo data are implemented.
- End-to-end flows for family and teacher testing with per-domain randomization and robust window/interval rules.
- Admin scheduling and reporting operational; discrepancy analysis available to inform follow-ups.
 
External Review Summary (Claude AI)

Strengths
- Solid architecture: multi-observer (family + teachers) with discrepancy analysis supports early detection.
- Window-based scheduling (1–6, 7–13, 14–20 months) and clear eligibility rules create structured screening timelines.
- Aggregation system: configurable modes (average/median/latest) and family weighting.
- Robust scoring: dual-layer (scaled 1–19 per domain; standard 70–160 overall) with lookup + fallback mapping; proper N/A handling; clear classification thresholds.
- Well-designed data model: normalized, practical pivot (teacher_student) with roles; uniqueness constraint on (student_id,test_date).

Issues to Address
- Critical:
  - Status enum mismatch: controllers use incomplete, but tests.status migration omits it. This will fail when setting status.
    • Proposed fix: add incomplete to the status enum via a new migration altering the column; update seeders/logic to recognize it.
  - Migration typo: children migration down() drops children instead of students.
    • Proposed fix: correct down() to Schema::dropIfExists('students').
- Important:
  - Session dependency: question order stored in session can be lost mid-test.
    • Proposed fix: persist per-domain question order on the tests record (JSON column) and only cache in session for speed.
  - Limits enforcement visibility: 3-test max and 6‑month interval enforced in controllers but not at DB/validation layer.
    • Proposed fix: add request validation rules/services to centralize checks; optionally add DB constraints and indexes to support checks.

Questions & Considerations
- Photo storage strategy: test_pictures exists, but retention/cleanup, size limits, and privacy are not defined.
- Enrollment date changes: how scheduled pending tests are re-aligned or migrated between windows.
- Concurrent test prevention: ensure a student cannot have multiple in_progress tests simultaneously (app + DB safeguards).
- Data retention policy: handling for terminated/cancelled tests and how long to keep responses/pictures.

Nice Touches
- Demo seeder scenarios enable realistic development/testing.
- Composer/NPM script integration streamlines dev workflow.
- Role-based dashboards and separation of concerns across controllers/views.

Addendum (2026-01-27) — Assessment Periods & States
- Introduced `assessment_periods` table linked to `students` to explicitly model three 6‑month windows per enrollment plus a 7‑day teacher grace (configurable in `config/eccd.php`).
- Fields: `index (1..3)`, `starts_at`, `ends_at`, `teacher_grace_end`, `status (scheduled|active|closed)`; unique per student+index.
- `Student` now auto-generates three periods on creation based on `enrollment_date`.
- `tests` link to a period via `assessment_period_id`; multiple teacher submissions per period are allowed; family submission is optional and aggregated/displayed separately.
- Expanded `tests.status` to support workflow: `draft`, `paused`, `finalized`, `archived`, `terminated` (legacy values `pending`, `in_progress`, `completed`, `cancelled` remain for compatibility).
- Visibility rules: non-admin roles see only `finalized|completed` tests; admin views exclude `archived` from active flows.
- Planned: scheduler jobs to auto-terminate drafts/in-progress tests when the window + grace expires; reconcile removed teacher assignments by terminating their drafts.
